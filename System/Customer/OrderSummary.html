<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <title>MATARIX - Order Summary</title>
    <!-- Google Fonts - Montserrat -->
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <!-- Bootstrap 4 CSS -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/4.6.2/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome for icons -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" rel="stylesheet">
    <!-- Custom CSS -->
    <link href="../Customer_assets/css/OrderSummary.css" rel="stylesheet">
    <!-- Customer Notifications CSS -->
    <link href="../Customer_assets/css/customer-notifications.css" rel="stylesheet">
    <!-- Mobile Enhancements CSS -->
    <link href="../Customer_assets/css/mobile-enhancements.css" rel="stylesheet">
</head>
<body>
    <!-- Skip to Content Link (Accessibility) -->
    <a href="#main-content" class="skip-link">Skip to main content</a>
    <!-- Main Content Start -->
    <main id="main-content">
    <!-- HEADER NAVIGATION -->
    <nav class="navbar navbar-expand-lg matarix-header">
        <div class="container-fluid">
            <!-- LOGO - Left -->
            <a class="navbar-brand" href="MainPage.html">
                <img src="../Customer_assets/images/LOGO.png" alt="MATARIX Logo" height="50" class="logo-img">
            </a>
            
            <!-- HEADER ICONS - Right -->
            <div class="ml-auto header-icons">
                <a href="#" class="navbar-icons" id="customerNotificationsBtn" title="Notifications" style="position: relative;">
                    <i class="fas fa-bell"></i>
                    <span class="notification-badge" id="customerNotificationBadge" style="display: none;">0</span>
                </a>
                <a href="Cart.html" class="navbar-icons" id="cartIcon">
                    <i class="fas fa-shopping-cart"></i>
                </a>
                <a href="OrderSummary.html" class="navbar-icons" title="Order Summary">
                    <i class="fas fa-clipboard-list"></i>
                </a>
                <a href="CustomerProfile.html" class="navbar-icons" id="userIcon">
                    <i class="fas fa-user"></i>
                </a>
            </div>
        </div>
    </nav>

    <!-- Sidebar Overlay (for mobile) -->
    <div class="sidebar-overlay" id="sidebarOverlay"></div>

    <div class="main-container">
        <!-- Sidebar -->
        <div class="sidebar">
            <ul class="sidebar-menu">
                <li><a href="./MainPage.html" class="sidebar-item"><i class="fas fa-home"></i> Home</a></li>
                <li><a href="./Quotation.html" class="sidebar-item"><i class="fas fa-cubes"></i> Materials</a></li>
                <li><a href="./OrderSummary.html" class="sidebar-item active"><i class="fas fa-box"></i> Orders</a></li>
            </ul>
        </div>

        <!-- Content -->
        <div class="content">
    <div class="container-fluid">
        <div class="row">

            <!-- MAIN CONTENT AREA -->
            <div class="main-content">
                <!-- ORDER SUMMARY HEADER -->
                <div class="order-header mb-4">
                    <div class="d-flex justify-content-between align-items-center flex-wrap">
                        <div class="d-flex align-items-center">
                            <button type="button" class="btn-back mr-3" id="orderSummaryBackBtn" style="display: none;" aria-label="Back to orders">
                                <i class="fas fa-arrow-left"></i> Back
                            </button>
                            <h1 class="order-title">Order Summary</h1>
                        </div>
                    </div>
                </div>

                <!-- ORDER TYPE TABS: Delivery | Pick Up -->
                <div class="order-type-tabs mb-3">
                    <button type="button" class="order-tab-btn active" id="delivery-orders-tab" data-tab="delivery-orders">
                        <i class="fas fa-truck"></i> Delivery Orders
                        <span class="tab-count" id="deliveryOrdersCount">0</span>
                    </button>
                    <button type="button" class="order-tab-btn" id="pickup-orders-tab" data-tab="pickup-orders">
                        <i class="fas fa-store"></i> Pick Up Orders
                        <span class="tab-count" id="pickupOrdersCount">0</span>
                    </button>
                </div>

                <!-- DELIVERY ORDERS TAB CONTENT -->
                <div class="order-tab-content active" id="delivery-orders-content">
                    <div class="delivery-sub-tabs mb-3">
                        <button type="button" class="sub-tab-btn active" data-delivery-sub="orders-placed">
                            <i class="fas fa-clock mr-1"></i> Orders Placed
                            <span class="tab-count" id="deliveryOrdersPlacedCount">0</span>
                        </button>
                        <button type="button" class="sub-tab-btn" data-delivery-sub="preparing">
                            <i class="fas fa-box-open mr-1"></i> Preparing
                            <span class="tab-count" id="deliveryPreparingCount">0</span>
                        </button>
                        <button type="button" class="sub-tab-btn" data-delivery-sub="out-for-delivery">
                            <i class="fas fa-truck mr-1"></i> Out for Delivery
                            <span class="tab-count" id="deliveryOutForDeliveryCount">0</span>
                        </button>
                        <button type="button" class="sub-tab-btn" data-delivery-sub="completed">
                            <i class="fas fa-check mr-1"></i> Completed
                            <span class="tab-count" id="deliveryCompletedCount">0</span>
                        </button>
                    </div>
                    <div class="delivery-sub-content active" id="delivery-orders-placed-content">
                        <div id="deliveryOrdersPlacedCards"></div>
                    </div>
                    <div class="delivery-sub-content" id="delivery-preparing-content">
                        <div id="deliveryPreparingCards"></div>
                    </div>
                    <div class="delivery-sub-content" id="delivery-out-for-delivery-content">
                        <div id="deliveryOutForDeliveryCards"></div>
                    </div>
                    <div class="delivery-sub-content" id="delivery-completed-content">
                        <div id="deliveryCompletedCards"></div>
                    </div>
                </div>

                <!-- PICK UP ORDERS TAB CONTENT -->
                <div class="order-tab-content" id="pickup-orders-content">
                    <div class="pickup-sub-tabs mb-3">
                        <button type="button" class="sub-tab-btn active" data-pickup-sub="orders-placed">
                            <i class="fas fa-clock mr-1"></i> Orders Placed
                            <span class="tab-count" id="pickupOrdersPlacedCount">0</span>
                        </button>
                        <button type="button" class="sub-tab-btn" data-pickup-sub="preparing">
                            <i class="fas fa-box-open mr-1"></i> Preparing
                            <span class="tab-count" id="pickupPreparingCount">0</span>
                        </button>
                        <button type="button" class="sub-tab-btn" data-pickup-sub="ready-for-pickup">
                            <i class="fas fa-truck mr-1"></i> Ready for Pick Up
                            <span class="tab-count" id="pickupReadyCount">0</span>
                        </button>
                        <button type="button" class="sub-tab-btn" data-pickup-sub="completed">
                            <i class="fas fa-check mr-1"></i> Completed
                            <span class="tab-count" id="pickupCompletedCount">0</span>
                        </button>
                    </div>
                    <div class="pickup-sub-content active" id="pickup-orders-placed-content">
                        <div id="pickupOrdersPlacedCards"></div>
                    </div>
                    <div class="pickup-sub-content" id="pickup-preparing-content">
                        <div id="pickupPreparingCards"></div>
                    </div>
                    <div class="pickup-sub-content" id="pickup-ready-for-pickup-content">
                        <div id="pickupReadyCards"></div>
                    </div>
                    <div class="pickup-sub-content" id="pickup-completed-content">
                        <div id="pickupCompletedCards"></div>
                    </div>
                </div>

                <!-- LEGACY: ORDERS CONTAINER (hidden, kept for single order view compatibility) -->
                <div id="ordersContainer" style="display: none;">
                </div>

                <!-- SINGLE ORDER VIEW (when order_id is in URL) - Hidden by default -->
                <div id="singleOrderView" style="display: none;">
                    <!-- ORDER PROGRESS TRACKER: Pending | Processing | To Receive | Completed -->
                    <div class="order-progress-tracker mb-4">
                        <div class="progress-step" data-step="1">
                            <div class="progress-step-icon"><i class="fas fa-clock"></i></div>
                            <span class="progress-step-label">Pending</span>
                        </div>
                        <div class="progress-connector"></div>
                        <div class="progress-step" data-step="2">
                            <div class="progress-step-icon"><i class="fas fa-box-open"></i></div>
                            <span class="progress-step-label">Processing</span>
                        </div>
                        <div class="progress-connector"></div>
                        <div class="progress-step" data-step="3">
                            <div class="progress-step-icon"><i class="fas fa-truck"></i></div>
                            <span class="progress-step-label">To Receive</span>
                        </div>
                        <div class="progress-connector"></div>
                        <div class="progress-step" data-step="4">
                            <div class="progress-step-icon"><i class="fas fa-check"></i></div>
                            <span class="progress-step-label">Completed</span>
                        </div>
                    </div>

                    <!-- ORDER ITEMS TABLE -->
                    <div class="order-table-container">
                        <div class="table-responsive">
                            <table class="table order-table mb-0">
                                <thead>
                                    <tr>
                                        <th>Product Name</th>
                                        <th class="text-center">Quantity</th>
                                        <th class="text-center d-none d-md-table-cell">Variation</th>
                                        <th class="text-center d-none d-sm-table-cell">Price</th>
                                        <th class="text-center">Total</th>
                                    </tr>
                                </thead>
                                <tbody id="orderItemsBody">
                                    <!-- Order items will be loaded dynamically here -->
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- DELIVERY/STATUS (left) | TOTAL & RATE (right) -->
                    <div class="row mt-3 order-summary-bottom-row">
                        <div class="col-md-7 order-summary-left">
                            <div id="deliveryMethodContainer"></div>
                            <div class="action-section mt-2" id="orderStatusActionSection">
                                <div class="order-status-message p-3 rounded" id="orderStatusMessage" style="background-color: #f8f9fa; border-left: 4px solid #BC3131;">
                                    <i class="fas fa-box-open mr-2"></i>
                                    <span id="orderStatusText">The store is preparing your order.</span>
                                </div>
                                <div class="order-rating-single mt-2" id="orderRatingDisplay" style="display: none;"></div>
                            </div>
                        </div>
                        <div class="col-md-5 order-summary-right">
                            <div class="order-total-section order-total-card" id="orderTotalSection">
                                <div class="order-total-breakdown-container">
                                    <div class="order-total-placeholder">Loading...</div>
                                </div>
                                <div class="order-total-actions mt-3 pt-3 border-top" id="orderTotalActions">
                                    <div id="proofOfPaymentDisplay" class="mb-3" style="display: none;">
                                        <label class="font-weight-bold mb-2" style="font-size: 0.9rem;">Proof of Payment</label>
                                        <div class="border rounded p-2" style="background: #f8f9fa;">
                                            <img id="proofOfPaymentImage" src="" alt="Proof of Payment" style="max-width: 100%; max-height: 180px; border-radius: 6px; cursor: pointer;" title="Click to view full size">
                                        </div>
                                    </div>
                                    <div class="order-to-rate-actions" id="orderToRateActions" style="display: none;">
                                        <a href="#" class="btn btn-to-rate btn-to-rate-sm" id="btnToRate">
                                            <i class="fas fa-star mr-2"></i>Submit Feedback
                                        </a>
                                    </div>
                                    <a href="#" class="btn btn-warning btn-sm mb-2" id="uploadProofLink" style="display: none;">
                                        <i class="fas fa-upload mr-2"></i>Reupload Proof of Payment
                                    </a>
                                    <a href="#" class="receipt-link" id="viewProofOfDeliveryLink" style="display: none;">
                                        <i class="fas fa-camera mr-2"></i>View Proof of Delivery
                                    </a>
                                    <a href="#" class="receipt-link" id="viewReceiptLink" style="display: none;">
                                        <i class="fas fa-receipt mr-2"></i>View Receipt
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Proof of Payment Upload Modal -->
    <div class="modal fade" id="proofUploadModal" tabindex="-1" role="dialog" aria-labelledby="proofUploadModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="proofUploadModalLabel">
                        <i class="fas fa-upload mr-2"></i>Upload Proof of Payment
                    </h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <p class="text-muted mb-3" id="proofUploadOrderInfo">Order # -</p>
                    <div class="proof-upload-area border rounded p-3 mb-3" style="background: #f8f9fa;">
                        <label for="proofUploadInput" id="proofUploadPrompt" class="upload-receipt-btn mb-0" style="cursor: pointer; display: block; text-align: center;">
                            <i class="fas fa-cloud-upload-alt fa-2x text-muted mb-2"></i>
                            <div class="text-muted">Click to select image (JPG, PNG, max 5MB)</div>
                        </label>
                        <input type="file" id="proofUploadInput" accept="image/*" style="display: none;">
                        <div id="proofUploadPreview" style="display: none; margin-top: 15px;">
                            <img id="proofUploadPreviewImg" src="" alt="Preview" style="max-width: 100%; max-height: 200px; border-radius: 8px; border: 2px solid #dee2e6;">
                        </div>
                    </div>
                </div>
                <div class="modal-footer d-flex justify-content-between align-items-center">
                    <button type="button" class="btn btn-sm btn-outline-danger" id="proofUploadRemoveBtn" style="display: none;">
                        <i class="fas fa-times mr-1"></i>Remove
                    </button>
                    <div class="d-flex ml-auto">
                    <button type="button" class="btn btn-secondary mr-2" data-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="proofUploadConfirmBtn" disabled>
                        <i class="fas fa-check-circle mr-2"></i>Submit Proof
                    </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Cancellation Notice Modal -->
    <div class="modal fade" id="cancellationModal" tabindex="-1" role="dialog" aria-labelledby="cancellationModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
                <div class="modal-header" style="background-color: #dc3545; color: white;">
                    <h5 class="modal-title" id="cancellationModalLabel">
                        <i class="fas fa-times-circle mr-2"></i>
                        Order Cancelled
                    </h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close" style="color: white;">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="cancellation-content">
                        <div class="alert alert-danger mb-3">
                            <i class="fas fa-exclamation-triangle mr-2"></i>
                            <strong>This order has been cancelled by our team.</strong>
                        </div>
                        
                        <div class="cancellation-details">
                            <div class="detail-row mb-3">
                                <strong><i class="fas fa-hashtag mr-2"></i>Order Number:</strong>
                                <span id="cancellationOrderNumber" class="ml-2">-</span>
                            </div>
                            
                            <div class="detail-row mb-3">
                                <strong><i class="fas fa-calendar-times mr-2"></i>Cancelled On:</strong>
                                <span id="cancellationDate" class="ml-2">-</span>
                            </div>
                            
                            <div class="detail-row mb-3">
                                <strong><i class="fas fa-comment-alt mr-2"></i>Reason:</strong>
                                <div id="cancellationReason" class="mt-2 p-3 bg-light rounded">
                                    <em class="text-muted">No reason provided.</em>
                                </div>
                            </div>
                        </div>
                        
                        <div class="cancellation-note mt-4">
                            <p class="text-muted mb-0">
                                <i class="fas fa-info-circle mr-2"></i>
                                If you have any questions about this cancellation, please contact our support team.
                            </p>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                    <a href="CustomerProfile.html" class="btn btn-primary">
                        <i class="fas fa-headset mr-2"></i>
                        Contact Support
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap 4 JS and dependencies -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.2/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Mobile sidebar toggle script -->
    <script>
        $(document).ready(function() {
            // VIEW RECEIPT LINK - Now handled by direct href link with parameter
            // No need for click handler since we're using href="receipt.html?from=order-summary"
        });
        
        // Track Order / View Order - both go to OrderSummary single order view
        // fromTab: 'completed' = hide Rate button in single order view
        window.trackOrder = function(orderId, isPickup, fromTab) {
            if (orderId) {
                const userId = sessionStorage.getItem('user_id');
                let url = 'OrderSummary.html?order_id=' + orderId;
                if (userId) {
                    url += (url.includes('?') ? '&' : '?') + 'user_id=' + userId;
                }
                if (fromTab) {
                    url += (url.includes('?') ? '&' : '?') + 'from=' + encodeURIComponent(fromTab);
                }
                window.location.href = url;
            } else {
                alert('No order ID provided.');
            }
        };
    </script>
    
    <!-- Customer Authentication Check - MUST load first to verify session -->
    <script src="../Customer_assets/js/customer_auth_check.js"></script>
    
    <!-- URL Authentication Helper - MUST load to preserve user_id in URLs -->
    <script src="../Customer_assets/js/url_auth_helper.js"></script>
    
    <!-- Load Order Summary -->
    <script src="../Customer_assets/js/load_order_summary.js?v=11"></script>
    
    <!-- MATARIX NAVIGATION SYSTEM -->
    <script src="../Customer_assets/js/navigation.js?v=3.0"></script>
    
    <!-- Navigation Tracker - Handle origin-aware navigation -->
    <script src="../Customer_assets/js/navigation-tracker.js"></script>
    <script src="../Customer_assets/js/sidebar-navigation.js"></script>
    <!-- Global Sidebar Toggle (Fallback) -->
    <script src="../Customer_assets/js/sidebar-toggle-global.js"></script>
    
    <!-- Customer Notifications System -->
    <script src="../Customer_assets/js/customer-notifications.js"></script>
    <script src="../Customer_assets/js/customer-notification-center.js"></script>
    
    <!-- Customer Notifications Modal -->
    <div class="modal fade" id="customerNotificationsModal" tabindex="-1" role="dialog" aria-labelledby="customerNotificationsModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-lg" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="customerNotificationsModalLabel">
                        <i class="fas fa-bell mr-2"></i>Notifications
                    </h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body" style="max-height: 600px; overflow-y: auto;">
                    <div id="customerNotificationsLoading" class="text-center py-4">
                        <i class="fas fa-spinner fa-spin"></i>
                        <p class="text-muted mt-2">Loading notifications...</p>
                    </div>
                    <div id="customerNotificationsList" style="display: none;">
                        <!-- Notifications will be loaded here -->
                    </div>
                    <div id="customerNotificationsEmpty" class="text-center py-5" style="display: none;">
                        <i class="fas fa-inbox" style="font-size: 3rem; color: #ccc;"></i>
                        <p class="text-muted mt-3">No notifications yet</p>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" id="markAllCustomerReadBtn" style="display: none;">
                        <i class="fas fa-check-double mr-2"></i>Mark All as Read
                    </button>
                </div>
            </div>
        </div>
    </div>
        </div>
    </div>
    </main>
    <!-- Main Content End -->
    
    <!-- Enhanced Mobile Navigation -->
    <script src="../Customer_assets/js/mobile-navigation-enhanced.js"></script>
    
    <!-- ========== MOBILE BOTTOM NAVIGATION ========== -->
    <nav class="mobile-bottom-nav" aria-label="Mobile Navigation">
        <a href="./MainPage.html" class="nav-item">
            <i class="fas fa-home"></i>
            <span>Home</span>
        </a>
        <a href="#products" class="nav-item">
            <i class="fas fa-th-large"></i>
            <span>Products</span>
        </a>
        <a href="./OrderSummary.html" class="nav-item">
            <i class="fas fa-box"></i>
            <span>Orders</span>
        </a>
    </nav>
    
    <!-- ========== MOBILE CART DRAWER ========== -->
    <div class="cart-overlay" id="cartOverlay"></div>
    <div class="cart-drawer" id="cartDrawer">
        <div class="cart-drawer-header">
            <h3>Shopping Cart</h3>
            <button class="cart-drawer-close" id="cartDrawerClose" aria-label="Close cart">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="cart-drawer-content">
            <p class="text-center text-muted">Cart items will load here</p>
            <p class="text-center"><a href="./Cart.html" class="btn btn-primary-red">View Full Cart</a></p>
        </div>
        <div class="cart-drawer-footer">
            <a href="./Cart.html" class="btn btn-primary-red btn-block">Go to Cart</a>
        </div>
    </div>
    
    <!-- ========== BACK TO TOP BUTTON ========== -->
    <button class="back-to-top" id="backToTop" aria-label="Back to top">
        <i class="fas fa-arrow-up"></i>
    </button>
    
    
</body>
</html>